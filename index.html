<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>高级音频播放器 | 语音转文字</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- Tailwind配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3B82F6',
            secondary: '#10B981',
            warning: '#EF4444'
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .glass-effect { @apply bg-white/10 backdrop-blur-md border border-white/20; }
      .animate-pulse-slow { animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    }
  </style>
</head>

<body class="font-inter bg-gradient-to-br from-slate-900 to-indigo-950 text-white min-h-screen p-4 md:p-8">
  <!-- 保密横幅 -->
  <div class="fixed top-0 left-0 right-0 bg-warning/90 text-center py-2 z-50">
    <p class="font-medium">内部信息严格保密，禁止外传给部门外使用</p>
  </div>

  <div class="max-w-5xl mx-auto pt-12">
    <!-- 标题 -->
    <header class="text-center mb-8 md:mb-12">
      <h1 class="text-[clamp(1.8rem,5vw,3rem)] font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-emerald-400 mb-2">
        音频播放器与语音转文字
      </h1>
      <p class="text-slate-400 max-w-2xl mx-auto">
        播放指定音频，调整播放速度（1-32倍），并实时将语音转换为文字
      </p>
    </header>
    
    <!-- 主内容 -->
    <main class="space-y-8">
      <!-- 音频链接区域 -->
      <section class="glass-effect rounded-xl p-6 shadow-xl">
        <h2 class="text-xl font-semibold mb-4 flex items-center">
          <i class="fa fa-link text-primary mr-2"></i>音频链接
        </h2>
        <div class="flex flex-col md:flex-row gap-3">
          <input 
            type="text" 
            id="audioUrl" 
            value="http://cld-games3store-g60-10021.s3v2.nie.netease.com/20251109/game_10021/cc_audio_server/f63954a5-fc4f-4768-9ba4-af78882b26af?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Date=20251102T081635Z&X-Amz-SignedHeaders=host&X-Amz-Expires=604799&X-Amz-Credential=CWIA3R2W8DVABATD7EHD%2F20251102%2F%2Fs3%2Faws4_request&X-Amz-Signature=c34fd6b02a93b80bb4c873e2eca38182f4f09356619c2dba5f6c6209f6efa033" 
            class="flex-1 bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary/50"
          >
          <button 
            id="copyBtn" 
            class="bg-primary hover:bg-primary/80 text-white px-6 py-3 rounded-lg transition-all duration-300 flex items-center justify-center gap-2"
          >
            <i class="fa fa-copy"></i>
            <span>复制链接</span>
          </button>
        </div>
        <div id="copyAlert" class="mt-3 text-sm hidden">
          <span class="inline-block px-3 py-1 rounded-full bg-green-500/20 text-green-400">链接已复制到剪贴板</span>
        </div>
      </section>
      
      <!-- 播放器区域 -->
      <section class="glass-effect rounded-xl p-6 shadow-xl">
        <h2 class="text-xl font-semibold mb-4 flex items-center">
          <i class="fa fa-play-circle text-primary mr-2"></i>音频播放控制
        </h2>
        
        <audio id="audioPlayer" src="" class="hidden"></audio>
        
        <div class="space-y-6">
          <!-- 播放按钮 -->
          <div class="flex justify-center">
            <button 
              id="playPauseBtn" 
              class="w-16 h-16 md:w-20 md:h-20 rounded-full bg-primary hover:bg-primary/80 flex items-center justify-center transition-all duration-300 shadow-lg hover:shadow-primary/30 hover:scale-105"
            >
              <i class="fa fa-play text-2xl md:text-3xl"></i>
            </button>
          </div>
          
          <!-- 进度条 -->
          <div class="space-y-2">
            <div class="flex justify-between text-sm text-slate-400">
              <span id="currentTime">00:00</span>
              <span id="duration">00:00</span>
            </div>
            <div class="relative h-2 bg-slate-700 rounded-full overflow-hidden cursor-pointer" id="progressContainer">
              <div id="progressBar" class="absolute top-0 left-0 h-full bg-primary transition-all duration-150"></div>
              <div id="bufferBar" class="absolute top-0 left-0 h-full bg-primary/30"></div>
            </div>
          </div>
          
          <!-- 音量控制 -->
          <div class="flex items-center gap-3">
            <i class="fa fa-volume-up text-slate-400" id="volumeIcon"></i>
            <input 
              type="range" 
              id="volumeSlider" 
              min="0" 
              max="1" 
              step="0.05" 
              value="1" 
              class="flex-1 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer"
            >
          </div>
          
          <!-- 倍速选择 -->
          <div class="flex items-center gap-3">
            <i class="fa fa-tachometer text-slate-400"></i>
            <label for="speedSelect" class="text-sm text-slate-400 whitespace-nowrap">播放速度:</label>
            <select 
              id="speedSelect" 
              class="flex-1 bg-slate-800/50 border border-slate-700 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50"
            ></select>
            <span id="currentSpeedDisplay" class="text-sm bg-slate-800/50 px-3 py-1 rounded-lg">1x</span>
          </div>
        </div>
      </section>
      
      <!-- ASR区域 -->
      <section class="glass-effect rounded-xl p-6 shadow-xl">
        <h2 class="text-xl font-semibold mb-4 flex items-center">
          <i class="fa fa-microphone text-primary mr-2"></i>语音转文字 (ASR)
        </h2>
        
        <div class="space-y-4">
          <div class="flex flex-wrap gap-3">
            <button 
              id="startAsrBtn" 
              class="bg-secondary hover:bg-secondary/80 text-white px-6 py-3 rounded-lg transition-all duration-300 flex items-center gap-2"
            >
              <i class="fa fa-play"></i>
              <span>开始转换</span>
            </button>
            <button 
              id="stopAsrBtn" 
              class="bg-slate-700 hover:bg-slate-600 text-white px-6 py-3 rounded-lg transition-all duration-300 flex items-center gap-2"
              disabled
            >
              <i class="fa fa-stop"></i>
              <span>停止转换</span>
            </button>
            <button 
              id="clearAsrBtn" 
              class="bg-slate-700 hover:bg-slate-600 text-white px-6 py-3 rounded-lg transition-all duration-300 flex items-center gap-2"
            >
              <i class="fa fa-trash"></i>
              <span>清空文本</span>
            </button>
          </div>
          
          <div class="relative">
            <div id="asrStatus" class="hidden absolute top-3 right-3 text-sm px-3 py-1 rounded-full bg-amber-500/20 text-amber-400 flex items-center gap-1">
              <i class="fa fa-circle-o-notch fa-spin"></i>
              <span>正在转换...</span>
            </div>
            <textarea 
              id="asrResult" 
              placeholder="语音转换的文字将显示在这里..." 
              class="w-full h-48 bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary/50 resize-none"
              readonly
            ></textarea>
          </div>
          
          <div class="text-sm text-slate-500 italic">
            <i class="fa fa-info-circle mr-1"></i>
            已启用音频分块处理（每30秒一段）| 超时可尝试：1. 降低播放速度 2. 切换更快网络 3. 点击"更换代理"
            <button id="changeProxyBtn" class="text-primary underline ml-2">更换代理</button>
          </div>
        </div>
      </section>
    </main>
    
    <!-- 页脚 -->
    <footer class="mt-12 text-center text-slate-500 text-sm">
      <p>© 2025 音频播放器与语音转文字工具 | 基于百度智能云ASR实现</p>
    </footer>
  </div>

  <script>
    // DOM元素
    const audioUrlInput = document.getElementById('audioUrl');
    const copyBtn = document.getElementById('copyBtn');
    const copyAlert = document.getElementById('copyAlert');
    const audioPlayer = document.getElementById('audioPlayer');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const progressContainer = document.getElementById('progressContainer');
    const progressBar = document.getElementById('progressBar');
    const bufferBar = document.getElementById('bufferBar');
    const currentTimeEl = document.getElementById('currentTime');
    const durationEl = document.getElementById('duration');
    const volumeSlider = document.getElementById('volumeSlider');
    const volumeIcon = document.getElementById('volumeIcon');
    const speedSelect = document.getElementById('speedSelect');
    const currentSpeedDisplay = document.getElementById('currentSpeedDisplay');
    const startAsrBtn = document.getElementById('startAsrBtn');
    const stopAsrBtn = document.getElementById('stopAsrBtn');
    const clearAsrBtn = document.getElementById('clearAsrBtn');
    const asrResult = document.getElementById('asrResult');
    const asrStatus = document.getElementById('asrStatus');
    const changeProxyBtn = document.getElementById('changeProxyBtn');
    
    // 音频参数
    let audioParams = { format: 'mp3', rate: 16000, channel: 1 };
    // 分块处理配置（每30秒一段，百度推荐单段不超过60秒）
    const CHUNK_DURATION = 30; // 秒
    let lastProcessedTime = 0; // 上次处理的时间点
    
    // 代理列表（可切换）
    const PROXY_LIST = [
      'https://api.allorigins.win/raw?url=',
      'https://proxy.cors.sh/',
      'https://cors.bridged.cc/'
    ];
    let currentProxyIndex = 0;
    let CORS_PROXY = PROXY_LIST[currentProxyIndex];
    
    // 初始化音频链接
    audioPlayer.src = audioUrlInput.value;
    
    // 生成1-32倍速选项
    for (let i = 1; i <= 32; i++) {
      const option = document.createElement('option');
      option.value = i;
      option.textContent = `${i}x`;
      if (i === 1) option.selected = true;
      speedSelect.appendChild(option);
    }
    
    // 切换代理按钮
    changeProxyBtn.addEventListener('click', () => {
      currentProxyIndex = (currentProxyIndex + 1) % PROXY_LIST.length;
      CORS_PROXY = PROXY_LIST[currentProxyIndex];
      asrResult.value += `[已切换代理：${CORS_PROXY.split('/')[2]}，请重新开始转换]\n`;
      baiduAccessToken = null; // 重置Token，使用新代理重新获取
    });
    
    // 音频链接同步 + 参数检测
    audioUrlInput.addEventListener('input', async () => {
      audioPlayer.src = audioUrlInput.value;
      audioPlayer.load();
      playPauseBtn.innerHTML = '<i class="fa fa-play text-2xl md:text-3xl"></i>';
      progressBar.style.width = '0%';
      bufferBar.style.width = '0%';
      currentTimeEl.textContent = '00:00';
      durationEl.textContent = '00:00';
      lastProcessedTime = 0;
      
      const alert = document.createElement('div');
      alert.className = 'mt-3 text-sm';
      alert.innerHTML = '<span class="inline-block px-3 py-1 rounded-full bg-blue-500/20 text-blue-400">音频链接已更新，正在检测参数...</span>';
      copyAlert.after(alert);
      
      try {
        await detectAudioParams(audioUrlInput.value);
        alert.innerHTML = `<span class="inline-block px-3 py-1 rounded-full bg-green-500/20 text-green-400">音频参数检测完成：格式=${audioParams.format}，采样率=${audioParams.rate}Hz，声道=${audioParams.channel}</span>`;
      } catch (err) {
        alert.innerHTML = `<span class="inline-block px-3 py-1 rounded-full bg-amber-500/20 text-amber-400">参数检测失败：${err.message}，将使用默认参数</span>`;
      }
      
      setTimeout(() => alert.remove(), 5000);
    });
    
    // 复制链接
    copyBtn.addEventListener('click', () => {
      navigator.clipboard.writeText(audioUrlInput.value)
        .then(() => {
          copyAlert.classList.remove('hidden');
          copyAlert.classList.add('animate-pulse-slow');
          setTimeout(() => copyAlert.classList.add('hidden'), 2000);
        })
        .catch(() => alert('复制失败，请手动复制'));
    });
    
    // 播放暂停
    playPauseBtn.addEventListener('click', () => {
      if (audioPlayer.paused || audioPlayer.ended) {
        audioPlayer.play()
          .then(() => playPauseBtn.innerHTML = '<i class="fa fa-pause text-2xl md:text-3xl"></i>')
          .catch(() => alert('播放失败，请检查音频链接'));
      } else {
        audioPlayer.pause();
        playPauseBtn.innerHTML = '<i class="fa fa-play text-2xl md:text-3xl"></i>';
      }
    });
    
    // 进度条更新
    audioPlayer.addEventListener('timeupdate', () => {
      const { currentTime, duration, buffered } = audioPlayer;
      if (duration) progressBar.style.width = `${(currentTime / duration) * 100}%`;
      if (buffered.length > 0) {
        const buffPercent = (buffered.end(buffered.length - 1) / duration) * 100;
        bufferBar.style.width = `${buffPercent}%`;
      }
      currentTimeEl.textContent = formatTime(currentTime);
      if (duration) durationEl.textContent = formatTime(duration);
    });
    
    // 时间格式化
    function formatTime(seconds) {
      const minutes = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }
    
    // 进度条跳转
    progressContainer.addEventListener('click', (e) => {
      const pos = (e.clientX - progressContainer.getBoundingClientRect().left) / progressContainer.offsetWidth;
      audioPlayer.currentTime = pos * audioPlayer.duration;
    });
    
    // 音量控制
    volumeSlider.addEventListener('input', () => {
      audioPlayer.volume = volumeSlider.value;
      updateVolumeIcon();
    });
    function updateVolumeIcon() {
      const vol = audioPlayer.volume;
      volumeIcon.className = vol === 0 ? 'fa fa-volume-off text-slate-400' : 
                             vol < 0.5 ? 'fa fa-volume-down text-slate-400' : 'fa fa-volume-up text-slate-400';
    }
    volumeIcon.addEventListener('click', () => {
      audioPlayer.muted = !audioPlayer.muted;
      volumeIcon.className = audioPlayer.muted ? 'fa fa-volume-off text-slate-400' : volumeIcon.className;
    });
    
    // 倍速控制
    speedSelect.addEventListener('change', () => {
      const speed = parseFloat(speedSelect.value);
      audioPlayer.playbackRate = speed;
      currentSpeedDisplay.textContent = `${speed}x`;
    });
    
    // 音频结束处理
    audioPlayer.addEventListener('ended', () => {
      playPauseBtn.innerHTML = '<i class="fa fa-play text-2xl md:text-3xl"></i>';
      if (isAsrActive) {
        stopASR();
        asrResult.value += '\n[音频结束，已停止识别]';
      }
    });
    
    // 检测音频参数
    async function detectAudioParams(audioUrl) {
      return new Promise((resolve, reject) => {
        const urlParts = audioUrl.split('.');
        const ext = urlParts[urlParts.length - 1].toLowerCase().split('?')[0];
        const supportedFormats = ['mp3', 'wav', 'amr', 'm4a'];
        audioParams.format = supportedFormats.includes(ext) ? ext : 'mp3';
        
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const request = new XMLHttpRequest();
        request.open('GET', audioUrl, true);
        request.responseType = 'arraybuffer';
        
        request.onload = function() {
          audioContext.decodeAudioData(request.response, (buffer) => {
            audioParams.rate = buffer.sampleRate;
            audioParams.channel = buffer.numberOfChannels > 1 ? 1 : buffer.numberOfChannels;
            resolve();
          }, (err) => {
            reject(new Error(`无法解析音频：${err.message}`));
          });
        };
        
        request.onerror = () => {
          reject(new Error('网络错误，无法获取音频信息'));
        };
        
        request.send();
      });
    }
    
    // 百度ASR核心逻辑（分块处理+超时优化）
    let isAsrActive = false;
    let baiduAccessToken = null;
    const BAIDU_CONFIG = {
      appId: '120657125',
      apiKey: 'ChGkXxbZLSk1osaRNpRbixxR',
      secretKey: '6ktcmDIlIynvQ9XGgG8DmlZqpqXROhgQ'
    };
    
    startAsrBtn.addEventListener('click', startASR);
    stopAsrBtn.addEventListener('click', stopASR);
    clearAsrBtn.addEventListener('click', () => {
      asrResult.value = '';
      lastProcessedTime = 0;
    });
    
    async function startASR() {
      if (audioPlayer.paused) audioPlayer.play().then(() => {
        playPauseBtn.innerHTML = '<i class="fa fa-pause text-2xl md:text-3xl"></i>';
      });
      
      isAsrActive = true;
      asrStatus.classList.remove('hidden');
      startAsrBtn.disabled = true;
      stopAsrBtn.disabled = false;
      asrResult.value += '[开始语音识别...]\n';
      asrResult.value += `[使用音频参数：格式=${audioParams.format}，采样率=${audioParams.rate}Hz，声道=${audioParams.channel}]\n`;
      asrResult.value += `[采用分块处理：每${CHUNK_DURATION}秒识别一段]\n`;
      asrResult.scrollTop = asrResult.scrollHeight;
      
      // 获取Token
      if (!baiduAccessToken) {
        try {
          const tokenUrl = `https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&client_id=${encodeURIComponent(BAIDU_CONFIG.apiKey)}&client_secret=${encodeURIComponent(BAIDU_CONFIG.secretKey)}`;
          const proxyUrl = `${CORS_PROXY}${encodeURIComponent(tokenUrl)}`;
          
          const res = await fetch(proxyUrl, {
            method: 'GET',
            headers: { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/114.0.0.0 Safari/537.36' }
          });
          
          if (!res.ok) throw new Error(`Token请求失败（状态码：${res.status}，代理：${CORS_PROXY.split('/')[2]}）`);
          
          const data = await res.json();
          if (data.error) throw new Error(`${data.error}：${data.error_description}`);
          
          baiduAccessToken = data.access_token;
          asrResult.value += '[已获取识别权限，开始分块转换...]\n';
        } catch (err) {
          asrResult.value += `[Token请求错误：${err.message}]\n`;
          stopASR();
          return;
        }
      }
      
      // 开始分块处理
      processAudioChunk();
    }
    
    // 分块处理音频（只处理当前播放位置的30秒片段）
    async function processAudioChunk() {
      if (!isAsrActive) return;
      
      const currentTime = audioPlayer.currentTime;
      // 检查是否需要处理新的片段（当前时间超过上次处理时间+分块时长）
      if (currentTime - lastProcessedTime < CHUNK_DURATION && lastProcessedTime !== 0) {
        // 未到新片段，等待一段时间后再检查
        const waitTime = Math.max(1000, (CHUNK_DURATION - (currentTime - lastProcessedTime)) * 1000);
        setTimeout(processAudioChunk, waitTime);
        return;
      }
      
      try {
        // 记录当前处理的时间点
        lastProcessedTime = currentTime;
        asrResult.value += `[处理片段：${formatTime(currentTime)} - ${formatTime(currentTime + CHUNK_DURATION)}]\n`;
        
        // 下载完整音频（实际项目中可优化为只下载片段，此处简化处理）
        const proxyAudioUrl = `${CORS_PROXY}${encodeURIComponent(audioUrlInput.value)}`;
        const audioRes = await Promise.race([
          fetch(proxyAudioUrl, { headers: { 'User-Agent': 'Mozilla/5.0' } }),
          new Promise((_, reject) => setTimeout(() => reject(new Error('音频下载超时（15秒）')), 15000))
        ]);
        
        if (!audioRes.ok) throw new Error(`音频下载失败（状态码：${audioRes.status}）`);
        
        // 截取当前时间段的音频（使用Web Audio API处理）
        const audioBlob = await audioRes.blob();
        const chunkBlob = await extractAudioChunk(audioBlob, currentTime, currentTime + CHUNK_DURATION);
        
        const formData = new FormData();
        formData.append('format', audioParams.format);
        formData.append('rate', audioParams.rate);
        formData.append('channel', audioParams.channel);
        formData.append('cuid', `asr-player-${BAIDU_CONFIG.appId}`);
        formData.append('token', baiduAccessToken);
        formData.append('speech', chunkBlob);
        formData.append('len', chunkBlob.size);
        
        // 识别请求（延长超时到20秒）
        const asrUrl = 'https://vop.baidu.com/server_api';
        const proxyAsrUrl = `${CORS_PROXY}${encodeURIComponent(asrUrl)}`;
        const asrRes = await Promise.race([
          fetch(proxyAsrUrl, { 
            method: 'POST', 
            body: formData,
            headers: { 'User-Agent': 'Mozilla/5.0' }
          }),
          new Promise((_, reject) => setTimeout(() => reject(new Error('识别请求超时（20秒）')), 20000))
        ]);
        
        const asrData = await asrRes.json();
        
        if (asrData.err_no === 0) {
          asrResult.value += `${asrData.result.join('')}\n`;
        } else {
          const errorMap = {
            3300: '参数错误（片段参数不匹配）',
            3301: '格式错误（片段格式不支持）',
            3302: '无有效语音（片段可能静音）',
            3303: '额度用尽',
            3304: '片段过长（已自动限制为30秒）',
            3305: '请求频繁（稍后重试）',
            3307: 'Token无效（刷新页面）',
            3308: '百度服务不可用'
          };
          asrResult.value += `[片段识别错误：${errorMap[asrData.err_no] || asrData.err_msg}（错误码：${asrData.err_no}）]\n`;
        }
      } catch (err) {
        asrResult.value += `[片段处理失败：${err.message}，5秒后重试该片段...]\n`;
        setTimeout(processAudioChunk, 5000); // 延长重试间隔，避免网络拥堵
        return;
      }
      
      asrResult.scrollTop = asrResult.scrollHeight;
      
      // 检查是否继续处理下一段
      if (!audioPlayer.ended && isAsrActive) {
        setTimeout(processAudioChunk, 1000); // 1秒后检查是否需要处理下一段
      }
    }
    
    // 截取音频片段（从startTime到endTime）
    async function extractAudioChunk(originalBlob, startTime, endTime) {
      return new Promise((resolve, reject) => {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const fileReader = new FileReader();
        
        fileReader.onload = function() {
          audioContext.decodeAudioData(fileReader.result, (buffer) => {
            // 计算片段的采样点范围
            const startSample = Math.floor(startTime * buffer.sampleRate);
            const endSample = Math.min(Math.floor(endTime * buffer.sampleRate), buffer.length);
            
            // 创建新的音频缓冲区
            const chunkBuffer = audioContext.createBuffer(
              buffer.numberOfChannels,
              endSample - startSample,
              buffer.sampleRate
            );
            
            // 复制音频数据到新缓冲区
            for (let channel = 0; channel < buffer.numberOfChannels; channel++) {
              const chunkData = chunkBuffer.getChannelData(channel);
              chunkData.set(buffer.getChannelData(channel).subarray(startSample, endSample));
            }
            
            // 将缓冲区转换为Blob
            const source = audioContext.createBufferSource();
            source.buffer = chunkBuffer;
            const dest = audioContext.createMediaStreamDestination();
            source.connect(dest);
            
            const recorder = new MediaRecorder(dest.stream);
            const chunks = [];
            recorder.ondataavailable = (e) => chunks.push(e.data);
            recorder.onstop = () => resolve(new Blob(chunks, { type: originalBlob.type }));
            
            source.start(0);
            recorder.start();
            setTimeout(() => {
              recorder.stop();
              source.stop();
            }, (endTime - startTime) * 1000);
          }, reject);
        };
        
        fileReader.readAsArrayBuffer(originalBlob);
      });
    }
    
    function stopASR() {
      isAsrActive = false;
      asrStatus.classList.add('hidden');
      startAsrBtn.disabled = false;
      stopAsrBtn.disabled = true;
      asrResult.value += '[已停止语音识别]\n';
    }
    
    // 页面初始化
    window.addEventListener('load', async () => {
      audioPlayer.load();
      audioPlayer.addEventListener('loadedmetadata', () => {
        durationEl.textContent = formatTime(audioPlayer.duration);
      });
      updateVolumeIcon();
      
      try {
        await detectAudioParams(audioUrlInput.value);
        console.log('初始音频参数检测完成：', audioParams);
      } catch (err) {
        console.log('初始参数检测失败：', err);
      }
    });
  </script>
</body>
</html>
